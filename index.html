<script>
const SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbxE2jugMmls3X7WSU1oA43HU_gxqq2Uq-d3B7NCtis44cvTeiROijP8Y68GfxvtJtjJ/exec";

// --- VALIDASI NOMOR HP --- //
const hpInput = document.querySelector("input[name='hp']");

hpInput.addEventListener("input", function () {
  // Hanya angka
  let val = this.value.replace(/\D/g, "");

  // Hilangkan spasi
  val = val.replace(/\s+/g, "");

  // Wajib mulai dengan 62
  if (!val.startsWith("62")) {
    val = "62" + val.replace(/^0+/, "");
  }

  this.value = val;
});


// --- SUBMIT FORM --- //
document.getElementById("orderForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const submitBtn = this.querySelector("button[type='submit']");
  submitBtn.disabled = true;
  submitBtn.textContent = "â³ Mengirim...";
  submitBtn.style.opacity = "0.7";

  const form = new FormData(this);

  try {
    await fetch(SCRIPT_URL, {
      method: "POST",
      body: form
    });

    // Template hasil
    const template = `
ðŸŸ¦ ORDER MASUK

ðŸ“¦ Biaya: ${form.get("biaya")}
ðŸ“… Kapan: ${form.get("kapan")}
ðŸ‘¤ Nama: ${form.get("nama")}
ðŸ“± https://wa.me/${form.get("hp")}
ðŸ“ Deskripsi: ${form.get("deskripsi") || "-"}

ðŸ“ Jemput: ${form.get("jemput") || "-"}
ðŸ“ Antar: ${form.get("antar") || "-"}

ðŸ§‘â€ðŸ’¼ Agent: ${form.get("agent")}
    `.trim();

    // Tampilkan hasil
    document.getElementById("templateBox").textContent = template;
    document.getElementById("resultCard").style.display = "block";

    // Tombol chat agent
    document.getElementById("chatBtn").href =
      "intent://chat.whatsapp.com/DlIfRxaICuRCXc1ZndEDTc#Intent;scheme=https;package=com.whatsapp.w4b;end";

    // Reset form
    this.reset();

  } catch (err) {
    alert("Gagal mengirim data!");
  }

  // Balikkan tombol
  submitBtn.disabled = false;
  submitBtn.textContent = "SUBMIT";
  submitBtn.style.opacity = "1";
});


// --- TOMBOL COPY TEMPLATE --- //
document.getElementById("copyBtn").addEventListener("click", async () => {
  try {
    await navigator.clipboard.writeText(
      document.getElementById("templateBox").textContent
    );

    copyBtn.textContent = "âœ” TERSALIN!";
    copyBtn.style.background = "#1e7c33";

    setTimeout(() => {
      copyBtn.textContent = "COPY TEMPLATE";
      copyBtn.style.background = "#28a745";
    }, 1500);

  } catch (err) {
    alert("Gagal menyalin!");
  }
});
</script>
